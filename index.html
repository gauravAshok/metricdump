<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Prometheus Dashboard</title>
</head>
<body>
<h1 id="title"></h1>
<div id="echart" style="width: 80vw;height:60vh;"></div>
<button id="download">Download</button>

<script type="module">

    function getName(result) {
        const labels = []
        for(let key in result.metric) {
            if (result.metric.hasOwnProperty(key)) {
                labels.push(`${key}=${result.metric[key]}`)
            }
        }
        return labels.join(" ")
    }


    const resp = {"status":"success","data":{"resultType":"matrix","result":[{"metric":{},"values":[[1637590992.160,"0.0055507759999997575"],[1637591006.160,"0.0055507759999997575"],[1637591020.160,"0.0055507759999997575"],[1637591034.160,"0.0063196436666620075"],[1637591048.160,"0.007005661749992953"],[1637591062.160,"0.007005661749992953"],[1637591076.160,"0.007005661749992953"],[1637591090.160,"0.007005661749992953"],[1637591104.160,"0.007005661749992953"],[1637591118.160,"0.007895091333324444"],[1637591132.160,"0.008100565249996805"],[1637591146.160,"0.008100565249996805"],[1637591160.160,"0.008100565249996805"],[1637591174.160,"0.008100565249996805"],[1637591188.160,"0.009315187999997457"],[1637591202.160,"0.00783548674999679"],[1637591216.160,"0.00783548674999679"],[1637591230.160,"0.00783548674999679"],[1637591244.160,"0.00783548674999679"],[1637591258.160,"0.00705902866666482"],[1637591272.160,"0.006073398249995421"],[1637591286.160,"0.006073398249995421"],[1637591300.160,"0.006073398249995421"],[1637591314.160,"0.006073398249995421"],[1637591328.160,"0.006073398249995421"],[1637591342.160,"0.005076625666665298"],[1637591356.160,"0.004822436749996939"],[1637591370.160,"0.004822436749996939"],[1637591384.160,"0.004822436749996939"],[1637591398.160,"0.004822436749996939"],[1637591412.160,"0.003524253333324623"],[1637591426.160,"0.0034384057499963205"],[1637591440.160,"0.0034384057499963205"],[1637591454.160,"0.0034384057499963205"],[1637591468.160,"0.0034384057499963205"],[1637591482.160,"0.0034524133333301656"],[1637591496.160,"0.0034524133333301656"],[1637591510.160,"0.0033524787499956687"],[1637591524.160,"0.0033524787499956687"],[1637591538.160,"0.0033524787499956687"],[1637591552.160,"0.0033524787499956687"],[1637591566.160,"0.003431135999998484"],[1637591580.160,"0.004979669249998153"],[1637591594.160,"0.004979669249998153"],[1637591608.160,"0.004979669249998153"],[1637591622.160,"0.004979669249998153"],[1637591636.160,"0.005286269000000251"],[1637591650.160,"0.005140137250002397"],[1637591664.160,"0.005140137250002397"],[1637591678.160,"0.005140137250002397"],[1637591692.160,"0.005140137250002397"],[1637591706.160,"0.005140137250002397"],[1637591720.160,"0.005793228666666058"],[1637591734.160,"0.005100231500001939"],[1637591748.160,"0.005100231500001939"],[1637591762.160,"0.005100231500001939"],[1637591776.160,"0.005100231500001939"],[1637591790.160,"0.005782750333338526"],[1637591804.160,"0.005208287500003905"],[1637591818.160,"0.005208287500003905"],[1637591832.160,"0.005208287500003905"],[1637591846.160,"0.005208287500003905"],[1637591860.160,"0.0037359603333394866"],[1637591874.160,"0.0033966467500050617"],[1637591888.160,"0.0033966467500050617"],[1637591902.160,"0.0033966467500050612"],[1637591916.160,"0.0033966467500050617"],[1637591930.160,"0.0033966467500050617"],[1637591944.160,"0.002961615000003803"],[1637591958.160,"0.0030974407500039547"],[1637591972.160,"0.0030974407500039547"],[1637591986.160,"0.0030974407500039547"],[1637592000.160,"0.0030974407500039547"],[1637592014.160,"0.0031228410000020785"],[1637592028.160,"0.004525428249998242"],[1637592042.160,"0.004525428249998242"],[1637592056.160,"0.004525428249998242"],[1637592070.160,"0.004525428249998242"],[1637592084.160,"0.004872271333330975"],[1637592098.160,"0.004358345499994698"],[1637592112.160,"0.004358345499994698"],[1637592126.160,"0.004358345499994698"],[1637592140.160,"0.004358345499994698"],[1637592154.160,"0.004358345499994698"],[1637592168.160,"0.005018225333325669"],[1637592182.160,"0.004768149499994934"],[1637592196.160,"0.004768149499994934"],[1637592210.160,"0.004768149499994934"],[1637592224.160,"0.004768149499994934"],[1637592238.160,"0.005189226666658442"],[1637592252.160,"0.004938247749990411"],[1637592266.160,"0.004938247749990411"],[1637592280.160,"0.004938247749990411"],[1637592294.160,"0.004938247749990411"],[1637592308.160,"0.0036732669999916343"],[1637592322.160,"0.003385006249992273"],[1637592336.160,"0.003385006249992273"],[1637592350.160,"0.003385006249992273"],[1637592364.160,"0.003385006249992273"],[1637592378.160,"0.003385006249992273"],[1637592392.160,"0.0035744856666610754"],[1637592406.160,"0.004062512999993829"],[1637592420.160,"0.004062512999993829"],[1637592434.160,"0.004062512999993829"],[1637592448.160,"0.004062512999993829"],[1637592462.160,"0.004077376666657528"],[1637592476.160,"0.0048417704999934585"],[1637592490.160,"0.0048417704999934585"],[1637592504.160,"0.0048417704999934585"],[1637592518.160,"0.0048417704999934585"],[1637592532.160,"0.0050605903333291735"],[1637592546.160,"0.0050605903333291735"],[1637592560.160,"0.004646344999997609"],[1637592574.160,"0.004646344999997609"],[1637592588.160,"0.004646344999997609"],[1637592602.160,"0.004646344999997609"],[1637592616.160,"0.005355051999998749"],[1637592630.160,"0.004823396249996392"],[1637592644.160,"0.004823396249996392"],[1637592658.160,"0.004823396249996392"],[1637592672.160,"0.004823396249996392"],[1637592686.160,"0.004588996666664494"],[1637592700.160,"0.004151377500001274"],[1637592714.160,"0.004151377500001274"],[1637592728.160,"0.004151377500001274"],[1637592742.160,"0.004151377500001274"],[1637592756.160,"0.004151377500001274"],[1637592770.160,"0.0031568526666679495"],[1637592784.160,"0.0032442142500030973"],[1637592798.160,"0.0032442142500030973"],[1637592812.160,"0.0032442142500030973"],[1637592826.160,"0.0032442142500030973"],[1637592840.160,"0.0031910826666698235"],[1637592854.160,"0.0046147647500021085"],[1637592868.160,"0.0046147647500021085"],[1637592882.160,"0.0046147647500021085"],[1637592896.160,"0.0046147647500021085"],[1637592910.160,"0.005076876666673039"],[1637592924.160,"0.004633197500005792"],[1637592938.160,"0.004633197500005792"],[1637592952.160,"0.004633197500005792"],[1637592966.160,"0.004633197500005792"],[1637592980.160,"0.004633197500005792"],[1637592994.160,"0.005231423333337185"],[1637593008.160,"0.005127948500003754"],[1637593022.160,"0.005127948500003754"],[1637593036.160,"0.005127948500003754"],[1637593050.160,"0.005127948500003754"],[1637593064.160,"0.005668498333335492"],[1637593078.160,"0.005420030500005169"],[1637593092.160,"0.005420030500005169"],[1637593106.160,"0.005420030500005169"],[1637593120.160,"0.005420030500005168"],[1637593134.160,"0.004264770333340569"],[1637593148.160,"0.00393502800000789"],[1637593162.160,"0.00393502800000789"],[1637593176.160,"0.00393502800000789"],[1637593190.160,"0.00393502800000789"],[1637593204.160,"0.00393502800000789"],[1637593218.160,"0.004145984000009169"],[1637593232.160,"0.004905418750006163"],[1637593246.160,"0.004905418750006163"],[1637593260.160,"0.004905418750006163"],[1637593274.160,"0.004905418750006163"],[1637593288.160,"0.004934717000007065"],[1637593302.160,"0.005149395250008126"],[1637593316.160,"0.005149395250008126"],[1637593330.160,"0.005149395250008126"],[1637593344.160,"0.005149395250008126"],[1637593358.160,"0.005307651333339436"],[1637593372.160,"0.005829360500001712"],[1637593386.160,"0.005829360500001712"],[1637593400.160,"0.005829360500001712"],[1637593414.160,"0.005829360500001712"],[1637593428.160,"0.005829360500001712"],[1637593442.160,"0.006790546999998999"],[1637593456.160,"0.006467195500000855"],[1637593470.160,"0.006467195500000855"],[1637593484.160,"0.006467195500000855"],[1637593498.160,"0.006467195500000855"],[1637593512.160,"0.006228353000002092"],[1637593526.160,"0.005858067250002819"],[1637593540.160,"0.005858067250002819"],[1637593554.160,"0.005858067250002819"],[1637593568.160,"0.005858067250002819"],[1637593582.160,"0.005879612999999987"],[1637593596.160,"0.005879612999999987"],[1637593610.160,"0.0056852827500009084"],[1637593624.160,"0.0056852827500009084"],[1637593638.160,"0.0056852827500009084"],[1637593652.160,"0.0056852827500009084"],[1637593666.160,"0.005115547666671698"],[1637593680.160,"0.0047154597500025375"],[1637593694.160,"0.0047154597500025375"],[1637593708.160,"0.0047154597500025375"],[1637593722.160,"0.0047154597500025375"],[1637593736.160,"0.004454899333334576"],[1637593750.160,"0.004396114500003989"],[1637593764.160,"0.004396114500003989"],[1637593778.160,"0.004396114500003989"],[1637593792.160,"0.004396114500003989"],[1637593806.160,"0.004396114500003989"],[1637593820.160,"0.00427908266667032"],[1637593834.160,"0.004275409250006135"],[1637593848.160,"0.004275409250006135"],[1637593862.160,"0.004275409250006135"],[1637593876.160,"0.004275409250006135"],[1637593890.160,"0.003999781666673622"],[1637593904.160,"0.004103802000003043"],[1637593918.160,"0.004103802000003043"],[1637593932.160,"0.004103802000003043"],[1637593946.160,"0.004103802000003043"],[1637593960.160,"0.004300004000005704"],[1637593974.160,"0.004251227500006394"],[1637593988.160,"0.004251227500006394"],[1637594002.160,"0.004251227500006394"],[1637594016.160,"0.004251227500006394"],[1637594030.160,"0.004251227500006394"],[1637594044.160,"0.0042617166666711155"],[1637594058.160,"0.00415777725000055"],[1637594072.160,"0.00415777725000055"],[1637594086.160,"0.00415777725000055"],[1637594100.160,"0.00415777725000055"],[1637594114.160,"0.004122239999996206"],[1637594128.160,"0.004122232000000281"],[1637594142.160,"0.004122232000000281"],[1637594156.160,"0.004122232000000281"],[1637594170.160,"0.004122232000000281"],[1637594184.160,"0.004024355000003273"],[1637594198.160,"0.006034928500000092"],[1637594212.160,"0.006034928500000093"],[1637594226.160,"0.006034928500000093"],[1637594240.160,"0.006034928500000093"],[1637594254.160,"0.006034928500000093"],[1637594268.160,"0.0066782719999973015"],[1637594282.160,"0.006830741750000868"],[1637594296.160,"0.006830741750000868"],[1637594310.160,"0.006830741750000868"],[1637594324.160,"0.006830741750000868"],[1637594338.160,"0.007825669333338206"],[1637594352.160,"0.00694316700000286"],[1637594366.160,"0.00694316700000286"],[1637594380.160,"0.00694316700000286"],[1637594394.160,"0.00694316700000286"],[1637594408.160,"0.00788348666666631"],[1637594422.160,"0.00770753474999708"],[1637594436.160,"0.00770753474999708"],[1637594450.160,"0.00770753474999708"],[1637594464.160,"0.00770753474999708"],[1637594478.160,"0.00770753474999708"],[1637594492.160,"0.006254496666665925"],[1637594506.160,"0.005717232000002071"],[1637594520.160,"0.005717232000002071"],[1637594534.160,"0.005717232000002071"],[1637594548.160,"0.00571723200000207"],[1637594562.160,"0.005193592333332238"],[1637594576.160,"0.005085920249996434"],[1637594590.160,"0.005085920249996434"]]}]}}
    const data = resp.data.result.map(result => {
        const name = getName(result)
        const data = result.values.map(d => {
            return [d[0] * 1000, d[1]];
        });
        return {
            name,
            values: data
        }
    });

    import { title } from "./i18n.mjs"
    import renderChart from './src/core/chart.mjs'
    document.getElementById('title').textContent = title['zh-CN'];

    const ele = document.getElementById('echart');
    const chart = renderChart(ele, {
        title: 'title',
        subtitle: 'subtitle',
        renderer: 'svg',
        unit: 'default'
    }, data)

    function saveAs(uri, filename) {
        var link = document.createElement('a');
        if (typeof link.download === 'string') {
            document.body.appendChild(link); // Firefox requires the link to be in the body
            link.download = filename;
            link.href = uri;
            link.click();
            document.body.removeChild(link); // remove the link when done
        } else {
            location.replace(uri);
        }
    }

    document.getElementById('download').onclick = function() {
        const canvas = document.querySelector('div#main canvas')
        const image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
        saveAs(image, 'tmp.png')
    }
</script>
</body>
</html>